---
id: story-006-002
epic: epic-006
title: Implement Stock Stop-Loss and Take-Profit Exits
priority: high
story_points: [TBD]
source_requirements: [FR-026, PIPE-044]
dependencies: [story-006-008]
blocks: [story-006-003, story-006-004]
---

# Story: Implement Stock Stop-Loss and Take-Profit Exits

## Description
Implement the two bracket exit conditions for stock positions: stop-loss at -10% from entry and take-profit at +15% from entry. Check each candle's high/low against the position's stop_loss_price and take_profit_price. On breach, trigger the appropriate exit with simulated fill at the trigger level.

## Acceptance Criteria
- [ ] Stop-loss triggers when any candle's low breaches stop_loss_price (entry_price * 0.90)
- [ ] Take-profit triggers when any candle's high breaches take_profit_price (entry_price * 1.15)
- [ ] Exit price for bracket exits is set to the trigger level (stop_loss_price or take_profit_price), not the candle's actual price
- [ ] Stop-loss has higher priority than take-profit when both breach in the same candle (per PIPE-044 priority order)
- [ ] Stop-loss exit triggers a full position close (100% of shares_remaining)
- [ ] Take-profit detection returns the exit event but does NOT close the full position; the 50% partial exit is handled downstream by story-006-003
- [ ] Function returns the exit reason string ('stop_loss' or 'take_profit') and exit details on trigger, or None if no trigger

## Technical Notes
- FR-026: Bracket exit strategy with stop-loss at -10% and take-profit at +15%.
- PIPE-044: Stock exit priority order is stop-loss > take-profit > trailing > breakeven > time.
- These are private functions in the hybrid exit architecture, called in priority cascade order.
- Stop-loss checks candle.low <= stop_loss_price; take-profit checks candle.high >= take_profit_price.
- Simulated fills use the trigger price, not the candle boundary.
- Take-profit at +15% will trigger partial exit mechanics (handled by story-006-003); this story handles the initial detection only.
- The hardcoded percentages (-10%, +15%) in the description are the system_config defaults. At runtime, exit conditions use the stored stop_loss_price and take_profit_price from the position record (set by story-005-008), not re-calculated percentages.

## Dependencies
- Depends on: story-006-008 (candle iteration provides candles to check)
- Blocks: story-006-003 (partial take-profit builds on take-profit detection), story-006-004 (breakeven promotion)
