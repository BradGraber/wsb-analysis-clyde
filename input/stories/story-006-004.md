---
id: story-006-004
epic: epic-006
title: Implement Stock Breakeven Promotion and Time Extension
priority: high
story_points: [TBD]
source_requirements: [FR-029, FR-030, PIPE-048]
dependencies: [story-006-002]
blocks: []
---

# Story: Implement Stock Breakeven Promotion and Time Extension

## Description
Implement breakeven stop promotion (at +5% gain AND Day 5, raise stop_loss_price to entry_price) and the three-tier time extension logic for stock positions. Time tiers: base 5 days if gain < +5%, extended 7 days if gain is +5% to +15% at Day 5, and trailing 10 days after a partial take-profit exit has occurred.

## Acceptance Criteria
- [ ] At +5% unrealized gain AND hold_days >= 5, stop_loss_price is updated to entry_price (breakeven promotion)
- [ ] If breakeven-promoted stop fires, exit_reason is set to 'breakeven_stop' (per PIPE-048)
- [ ] Base time stop triggers at Day 5 if gain is below +5% (exit 100%, exit_reason='time_stop')
- [ ] Extended time stop triggers at Day 7 if gain is between +5% and +15% at Day 5 (exit 100%, exit_reason='time_stop')
- [ ] Trailing time stop triggers at Day 10 after a partial take-profit has occurred (exit 100%, exit_reason='time_stop')
- [ ] Time tier is determined by position state at each monitoring check: base (gain < +5%), extended (gain +5% to +15% at Day 5 transition), trailing (partial take-profit occurred). Once a position transitions to a higher tier, it does not revert to a lower tier even if gain drops.
- [ ] When trailing_stop_active is TRUE, the trailing time tier (10 days) always applies regardless of current gain level
- [ ] Time stop uses calendar days (not trading days) for hold_days calculation
- [ ] Time stop exit price is set to current_price (not a trigger level)

## Technical Notes
- FR-029: Gain-based time extension tiers (base 5, extended 7, trailing 10 calendar days).
- FR-030: Breakeven stop promotion at +5% gain and Day 5, raising stop_loss_price to entry_price.
- PIPE-048: When stop_loss_price == entry_price, exit_reason = 'breakeven_stop'.
- PIPE-044: In priority cascade, breakeven check is after trailing stop but before time stop.
- hold_days is calculated as calendar days from position open_date.
- Time extensions are mutually exclusive tiers based on position state at evaluation time.

## Dependencies
- Depends on: story-006-002 (stop-loss detection provides the framework for breakeven stop)
- Blocks: none
