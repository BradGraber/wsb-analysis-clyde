---
id: story-004-002
epic: epic-004
title: Implement Quality Signal Detection
priority: high
story_points: [TBD]
source_requirements: [FR-001, FR-015, FR-017, PIPE-025]
dependencies: [story-004-001, story-004-004]
blocks: [story-004-006]
---

# Story: Implement Quality Signal Detection

## Description
Implement the Quality signal detection algorithm that filters comments for substantive reasoning (has_reasoning=true, sarcasm_detected=false, ai_confidence >= 0.6), checks unanimity on per-ticker sentiment direction, and fires a signal when at least 2 distinct users meet all criteria. All thresholds are read from system_config at runtime (CFG-SIGNAL-THRESHOLDS).

## Acceptance Criteria
- [ ] Comments are filtered by has_reasoning=true AND sarcasm_detected=false AND ai_confidence >= quality_min_confidence (default 0.6 from system_config); a comment with ai_confidence = 0.6 exactly qualifies (inclusive boundary)
- [ ] Distinct users are counted among qualifying comments for each ticker
- [ ] Directional alignment is checked using comment_tickers.sentiment: all qualifying comments must agree on bullish OR all on bearish for this ticker
- [ ] Signal fires when distinct_users >= quality_min_users (default 2 from system_config) AND unanimity is achieved
- [ ] Signal direction is set to the unanimous sentiment direction (bullish or bearish)
- [ ] Signal does NOT fire when qualifying users disagree on direction, even if user count meets threshold
- [ ] All threshold values (quality_min_confidence, quality_min_users) are read from system_config table at runtime, not hardcoded

## Technical Notes
- PIPE-025: Quality signal calculation uses comment_tickers.sentiment for per-ticker directional alignment
- Unanimity means 100% agreement among qualifying comments -- a single dissenting comment disqualifies the signal
- Volume score for Quality signals uses distinct user count (not comment count), per confidence calculation formula
- Alignment score for Quality signals is always 1.0 (unanimity requirement makes it maximal by definition)
- This story produces signal metadata (direction, user count, ai_confidence values) that feeds into story-004-004 (confidence calculation) and story-004-006 (rollup)

## Dependencies
- Depends on: story-004-001 (comment aggregation), story-004-004 (confidence calculation)
- Blocks: story-004-006 (daily rollup)
