---
id: story-008-005
epic: epic-008
title: Implement Dual Sparklines
priority: high
story_points: [TBD]
source_requirements: [UI-SPARKLINES, FR-008]
dependencies: [story-008-003, story-008-004]
blocks: []
---

# Story: Implement Dual Sparklines

## Description
Implement the dual sparkline visualization on each signal card: a confidence sparkline (from batch GET /signals/history) and a price sparkline (from lazy GET /prices/{ticker}). Each sparkline is approximately 100px x 30px with adaptive rendering (dots for 2 or fewer points, line for 3+). Price sparklines are lazy-loaded with max 5 concurrent requests and cached on tab switch.

## Acceptance Criteria
- [ ] Confidence sparkline renders from GET /signals/history data (batched per tab load, grouped by ticker, default 14 days)
- [ ] Price sparkline renders from GET /prices/{ticker} data (lazy-loaded per visible signal card)
- [ ] Each sparkline renders at approximately 100px x 30px
- [ ] Adaptive rendering: data with <=2 points shows as scatter dots; data with 3+ points shows as a line
- [ ] Maximum 5 concurrent price sparkline requests are in-flight at any time (request queue/pool)
- [ ] A loading placeholder is displayed while sparkline data is being fetched
- [ ] Sparkline data is cached in-memory per portfolio tab so switching tabs does not re-fetch

## Technical Notes
- Uses the library/approach recommended by story-008-004 (sparkline spike)
- Confidence sparkline data flow: on tab mount, call `GET /signals/history?signal_type=quality&days=14`, distribute results to signal cards by ticker
- Price sparkline data flow: for each visible signal card, call `GET /prices/{ticker}?days=14`, throttled to max 5 concurrent
- Concurrency throttle: use a simple semaphore or queue pattern (e.g., p-limit npm package or custom implementation)
- Cache strategy: composable stores fetched data in a `Map<portfolioId, Map<ticker, data>>`, cleared only on page reload
- Placeholder: a gray dashed line or shimmer effect at the sparkline dimensions
- FR-008: 7-14 day sparkline windows, signal confidence history + stock price side by side

## Dependencies
- Depends on: story-008-003 (signal cards provide the mounting point for sparklines), story-008-004 (spike determines implementation approach)
- Blocks: none
