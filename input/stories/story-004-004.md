---
id: story-004-004
epic: epic-004
title: Implement Signal Confidence Calculation
priority: high
story_points: [TBD]
source_requirements: [FR-040, PIPE-027]
dependencies: [story-004-001]
blocks: [story-004-002, story-004-003]
---

# Story: Implement Signal Confidence Calculation

## Description
Implement the 4-factor weighted confidence formula: volume_score * 0.25 + alignment_score * 0.25 + avg_ai_confidence * 0.30 + avg_author_trust * 0.20. Volume score calculation differs by signal type (distinct users for Quality, comment count for Consensus). Alignment score is 1.0 for Quality (unanimity) and a normalized percentage for Consensus. All weights are read from system_config at runtime (CFG-CONFIDENCE-WEIGHTS).

## Acceptance Criteria
- [ ] Confidence is calculated using the formula: volume_score * w1 + alignment_score * w2 + avg_ai_confidence * w3 + avg_author_trust * w4 where weights are read from system_config
- [ ] Default weights are 0.25, 0.25, 0.30, 0.20 respectively (from system_config CFG-CONFIDENCE-WEIGHTS)
- [ ] Volume score for Quality signals: min(1.0, distinct_users / (quality_min_users * 3))
- [ ] Volume score for Consensus signals: min(1.0, comment_count / (consensus_min_comments * 3))
- [ ] Alignment score for Quality signals is always 1.0 (unanimity requirement)
- [ ] Alignment score for Consensus signals: (actual_alignment - min_alignment) / (1.0 - min_alignment), clamped to [0.0, 1.0]
- [ ] avg_ai_confidence is the mean of ai_confidence values from contributing comments
- [ ] avg_author_trust is the mean of author trust_score values from contributing comments, using 0.5 default for unknown authors (TRUST-COLD-START)

## Technical Notes
- PIPE-027: Signal confidence calculation with config-driven weights from system_config
- The volume_score formula uses the signal-type-specific threshold multiplied by 3 as the denominator
- Alignment score normalization for Consensus: if actual_alignment equals min_alignment, score is 0.0; if alignment is 1.0, score is 1.0
- Author trust scores come from the authors table; authors not yet in the table use the cold-start default of 0.5
- This function should accept signal type as parameter to branch on volume/alignment calculation
- Final confidence value should be a float in [0.0, 1.0]

## Dependencies
- Depends on: story-004-001 (comment aggregation provides comment data with ai_confidence and author info)
- Blocks: story-004-002 (quality detection needs confidence), story-004-003 (consensus detection needs confidence)
