---
id: story-007-001
epic: epic-007
title: Set Up FastAPI Application
priority: high
story_points: [TBD]
source_requirements: [ERR-LOGGING, NFR-005]
dependencies: [epic-001]
blocks: [story-007-002, story-007-003]
---

# Story: Set Up FastAPI Application

## Description
Initialize the FastAPI application with CORS configuration, startup/shutdown event handlers for database connection lifecycle, and structlog JSON-formatted logging to `logs/backend.log`. This is the foundational story for the entire REST API layer and is part of Phase 7a (early scaffold, Weeks 2-3).

## Acceptance Criteria
- [ ] FastAPI app initializes successfully with `uvicorn` and responds to health check requests
- [ ] CORS middleware is configured to allow local development origins (localhost:5173 or equivalent Vue dev server port)
- [ ] Startup event handler acquires a database connection (from epic-001 connection manager) and stores it in app state
- [ ] Shutdown event handler cleanly closes the database connection
- [ ] structlog is configured with JSON formatting, outputting to `logs/backend.log` with levels DEBUG through CRITICAL
- [ ] Log entries include timestamp, level, logger name, and structured context fields (no unstructured print statements)
- [ ] Application supports 3x daily usage pattern without resource leaks (NFR-005)

## Technical Notes
- Phase 7a story -- can begin as soon as epic-001 database connection manager is available
- Use structlog with `structlog.stdlib.ProcessorPipeline` for JSON output
- CORS origins should be configurable but default to localhost for development
- Startup/shutdown hooks use FastAPI `lifespan` context manager (preferred over deprecated `on_event`)
- Database connection manager from epic-001 story-001-004 provides the SQLite connection with WAL mode and foreign key enforcement
- Log file directory (`logs/`) should be created if it does not exist

## Dependencies
- Depends on: epic-001 (database connection manager, story-001-004)
- Blocks: story-007-002, story-007-003
