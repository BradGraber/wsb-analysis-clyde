---
id: story-008-007
epic: epic-008
title: Implement Position List and Monitoring Indicators
priority: high
story_points: [TBD]
source_requirements: [UI-POSITION-STATES, UI-EXIT-LABELS, UI-MANUAL-CLOSE]
dependencies: [story-008-002]
blocks: [story-008-012]
---

# Story: Implement Position List and Monitoring Indicators

## Description
Build the Positions sub-tab view showing all positions for the active portfolio with 3 primary states (Active/Monitoring, Near Exit, Partially Closed) and the Market Closed overlay. Map the 8 canonical exit_reason database values to human-readable labels displayed as badges on closed positions. Include the manual close button for open positions.

## Acceptance Criteria
- [ ] Positions sub-tab displays a list of positions for the active portfolio, fetched via GET /positions?portfolio_id=X
- [ ] "Active/Monitoring" state: standard display with current_price, unrealized_return_pct, hold_days
- [ ] "Near Exit" state: amber/warning styling when position is within 2% of any exit trigger (nearest_exit_distance_pct <= 2.0)
- [ ] "Partially Closed" state: shows shares_remaining/shares_total or contracts_remaining/contracts_total with visual indicator of partial closure
- [ ] "Market Closed" overlay: when market is closed, positions are greyed with "as of [last_close_timestamp]" label
- [ ] 8 exit_reason values are mapped to human-readable labels: stop_loss->"Stop Loss", take_profit->"Take Profit", trailing_stop->"Trailing Stop", breakeven_stop->"Breakeven Stop", time_stop->"Time Stop", expiration->"Expiration", manual_close->"Manual Close", replaced->"Replaced"
- [ ] Exit reason labels are displayed as colored badges on closed positions

## Technical Notes
- Position list component: `<PositionList :portfolio-id="portfolioId" />`
- Near Exit detection: use nearest_exit_distance_pct convenience field from GET /positions response
- Market hours detection: client-side calculation using US Eastern Time (9:30 AM - 4:00 PM ET, Mon-Fri)
- Manual close button triggers inline popover from UI-MANUAL-CLOSE: reason (required text input), quantity radio (full/partial 50%), confirm button, spinner during request, toast on success
- Manual close calls POST /positions/{id}/close from story-007-008
- Badge colors: stop_loss=red, take_profit=green, trailing_stop=blue, breakeven_stop=teal, time_stop=orange, expiration=yellow, manual_close=gray, replaced=purple
- Convenience fields (hold_days, unrealized_return_pct) come pre-computed from the API

## Dependencies
- Depends on: story-008-002 (positions sub-tab view and usePositions composable)
- Blocks: story-008-012 (exit and portfolio isolation tests depend on position rendering)
