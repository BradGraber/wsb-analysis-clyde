---
id: story-008-014
epic: epic-008
title: Set Up E2E Regression Suite
priority: medium
story_points: [TBD]
source_requirements: [UI-TECH-STACK, NFR-007]
dependencies: [story-008-013]
blocks: []
---

# Story: Set Up E2E Regression Suite

## Description
Establish the end-to-end regression suite infrastructure with two modes: per-commit tests using mocked APIs and weekly smoke tests using real APIs. Define baseline test scenarios covering the full user workflow: trigger analysis, view signals, check positions, and close a position.

## Acceptance Criteria
- [ ] E2E test infrastructure is set up using a browser automation tool (Playwright or Cypress) with Vue 3 compatibility
- [ ] Per-commit test suite runs with mocked API responses (using VCR.py cassettes or equivalent frontend mocking) and completes in under 2 minutes
- [ ] A CI configuration file (e.g., .github/workflows/e2e-weekly.yml) defines the weekly smoke test schedule and real API credentials via secrets
- [ ] Baseline scenario 1: trigger analysis via UI button, observe progress indicator advancing through 4 stages, verify results summary appears on completion
- [ ] Baseline scenario 2: navigate to signals tab, verify signal cards render with correct layout, click signal card and verify evidence modal opens with comments
- [ ] Baseline scenario 3: navigate to positions tab, verify position list displays with correct states, verify exit reason badges on closed positions
- [ ] Baseline scenario 4: open a position's manual close popover, fill in reason, confirm close, verify position status updates to closed

## Technical Notes
- Playwright is recommended over Cypress for better Vue 3 support and faster execution
- Per-commit tests: mock the FastAPI backend entirely (intercept network requests) so no backend is needed
- Weekly smoke tests: require a running backend with real API credentials configured
- Test configuration: use environment variable (E2E_MODE=mock|real) to switch between modes
- Mocked mode: use Playwright's route interception to serve pre-recorded API responses
- Real mode: start backend, wait for readiness, run tests with extended timeouts (pipeline may take 10-30 min)
- Baseline scenarios should be parameterized to run across all 4 portfolio tabs
- NFR-007: Tests validate that the UI is "usable without training" by following a natural workflow

## Dependencies
- Depends on: story-008-013 (VCR.py and error test infrastructure)
- Blocks: none
