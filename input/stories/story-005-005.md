---
id: story-005-005
epic: epic-005
title: Implement Stocks Long-Only Rule
priority: high
story_points: [TBD]
source_requirements: [FR-036, PIPE-034, FR-024]
dependencies: [story-005-003]
blocks: []
---

# Story: Implement Stocks Long-Only Rule

## Description
Implement the Phase 1 stocks long-only constraint: when a signal direction is bearish, skip the stock portfolio entirely (no short positions) but still open options positions (puts for bearish). When both Quality and Consensus signals fire on the same ticker, open positions in all applicable portfolios (up to 4). Conflicting directions between signal types are valid and result in opposing positions.

## Acceptance Criteria
- [ ] Bearish signals skip stock portfolio opens: no position is created in stocks_quality or stocks_consensus for bearish signals
- [ ] Bearish signals still open options positions: puts are created in options_quality or options_consensus as appropriate
- [ ] Log message is emitted when stock portfolio is skipped: "Bearish signal: stock position skipped (long-only Phase 1), options position opened."
- [ ] Bullish signals open positions in both stock and options portfolios as normal
- [ ] When both Quality and Consensus fire on same ticker, positions open in all 4 portfolios (stocks_quality, options_quality, stocks_consensus, options_consensus) subject to long-only rule
- [ ] Conflicting directions (e.g., Quality=bullish, Consensus=bearish) result in valid independent positions in their respective portfolios

## Technical Notes
- FR-036: Stocks are long-only in Phase 1; bearish signals recorded but no short stock positions
- PIPE-034: Bearish signal skips stock portfolio, options still opens puts
- FR-024: Dual signal handling -- both signal types independently open positions
- The long-only rule is applied per target portfolio, not per signal: the signal is still valid, just the stock portfolio leg is skipped
- This filtering should happen after target portfolio determination (story-005-003) but before position opening (story-005-007)
- Phase 2 may add short selling; design the filter to be easily toggleable via system_config

## Dependencies
- Depends on: story-005-003 (target portfolio determination)
- Blocks: none (feeds into position opening flow)
