---
id: story-005-003
epic: epic-005
title: Implement Confidence-Weighted Position Sizing
priority: high
story_points: [TBD]
source_requirements: [FR-023, PIPE-033]
dependencies: [story-005-002]
blocks: [story-005-004, story-005-005, story-005-007]
---

# Story: Implement Confidence-Weighted Position Sizing

## Description
Implement position sizing logic with confidence-based multipliers for stocks and fixed percentage for options. Stocks use a 3-tier multiplier system (0.5x/0.75x/1.0x) applied to base_allocation (portfolio_value / 20). Options use a fixed 2% of portfolio_value. All positions are clamped to minimum 2% and maximum 15% of portfolio value. Determine target portfolios based on signal type (Quality or Consensus).

## Acceptance Criteria
- [ ] Stock base_allocation is calculated as portfolio_value / 20 (5% of portfolio)
- [ ] Confidence-to-multiplier mapping uses interval notation: [0.50, 0.70) -> 0.5x multiplier, [0.70, 0.90) -> 0.75x multiplier, [0.90, 1.00] -> 1.0x multiplier. Boundary values fall into the higher tier (e.g., 0.70 is in the 0.75x tier).
- [ ] Options position size is fixed at portfolio_value * 0.02 (2% of portfolio) regardless of confidence
- [ ] All position sizes are clamped: minimum 2% of portfolio_value, maximum 15% of portfolio_value
- [ ] Target portfolios are determined by signal_type: Quality -> stocks_quality + options_quality, Consensus -> stocks_consensus + options_consensus
- [ ] Confidence multiplier thresholds and sizing percentages are read from system_config at runtime
- [ ] Function returns position_size (dollar amount) and target portfolio list for each qualified signal

## Technical Notes
- FR-023: Confidence-weighted position sizing with multipliers and risk limits
- PIPE-033: Target portfolio determination based on signal_type
- Confidence tiers: [0.5, 0.7) -> 0.5x, [0.7, 0.9) -> 0.75x, [0.9, 1.0] -> 1.0x (boundary values go to higher tier)
- The min/max clamping (2-15%) applies after the multiplier is applied to base_allocation
- For options, the 2% fixed allocation means all options positions are the same dollar size regardless of confidence
- portfolio_value should come from the specific target portfolio record (each portfolio has independent value)
- When both Quality and Consensus fire on same ticker (FR-024), positions open in all 4 portfolios

## Dependencies
- Depends on: story-005-002 (qualified signals as input)
- Blocks: story-005-004 (replacement logic needs sizing), story-005-005 (long-only rule needs target portfolios), story-005-007 (cash guard needs position size)
