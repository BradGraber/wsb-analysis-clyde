---
id: story-008-009
epic: epic-008
title: Implement 4-Stage Progress Indicator
priority: high
story_points: [TBD]
source_requirements: [UI-PROGRESS, UI-RESULTS-SUMMARY, UI-WARNINGS]
dependencies: [story-008-001]
blocks: [story-008-010]
---

# Story: Implement 4-Stage Progress Indicator

## Description
Build the 4-stage analysis progress indicator that shows pipeline status during an active run: Fetching Reddit, Analyzing Comments (N/total), Detecting Signals, and Monitoring Prices. The current stage is highlighted as active, subsequent stages are dimmed. On completion, display a results summary overlay and render accumulated warnings with the tiered display rules.

## Acceptance Criteria
- [ ] 4 stages are displayed in order: "Fetching Reddit", "Analyzing comments (N/total)", "Detecting signals", "Monitoring prices"
- [ ] Current active stage is visually highlighted (e.g., bold, colored, with spinner)
- [ ] Completed stages show a checkmark; upcoming stages are dimmed/grayed
- [ ] "Analyzing comments" stage shows progress counter (progress_current/progress_total from GET /runs/{id}/status)
- [ ] On pipeline completion (status='completed'), a results summary overlay appears showing: signals_created, positions_opened, exits_triggered, errors count
- [ ] On pipeline failure (status='failed'), error message from the run is displayed prominently
- [ ] Warnings display: 0 warnings omits the section entirely, 1-3 warnings show as inline bulleted list, 4+ warnings show first 3 with expandable "and N more..." toggle
- [ ] Stage-to-pipeline mapping: Phase 1+2 -> 'Fetching Reddit', Phase 3+3.5 -> 'Analyzing comments', Phase 4 -> 'Detecting signals', Phase 5+6 -> 'Monitoring prices'

## Technical Notes
- Progress polling: calls GET /runs/{id}/status every 10 seconds while status='running'
- Stage mapping from API fields: current_phase (1-4) maps to stage index, phase_label provides display text
- Results summary fields come from the completed run's response (signals_created, positions_opened, etc.)
- Warnings are deserialized from the analysis_runs.warnings JSON field
- Warning display includes type prefix label (e.g., "Schwab Stock Unavailable: AAPL")
- The progress indicator should be a persistent component in the header/top area, visible across all tabs
- Use `setInterval` for polling with cleanup on component unmount or run completion
- Consider a `useAnalysis` composable to manage polling state and results

## Dependencies
- Depends on: story-008-001 (Vue scaffold for persistent header component placement)
- Blocks: story-008-010 (reload recovery resumes the progress indicator)
