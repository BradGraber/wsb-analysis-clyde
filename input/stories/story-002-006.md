---
id: story-002-006
epic: epic-002
title: Implement Engagement and Depth Scoring
priority: high
story_points: [TBD]
source_requirements: [PIPE-011, PIPE-012]
dependencies: [story-002-003]
blocks: [story-002-007]
---

# Story: Implement Engagement and Depth Scoring

## Description
Calculate two scoring components for comment prioritization: engagement score using the logarithmic formula log(upvotes + 1) x reply_count, and depth penalty that reduces scores for deeply nested comments to focus on top-level substantive discussion. Both values feed into the composite priority formula.

## Acceptance Criteria
- [ ] Engagement score is calculated using the exact formula: log(upvotes + 1) x reply_count, where log is the natural logarithm (math.log)
- [ ] Comments with zero upvotes produce log(0 + 1) = log(1) = 0, resulting in engagement_score of 0.0 regardless of reply count
- [ ] Comments with zero replies produce engagement_score of 0.0 regardless of upvote count
- [ ] Depth penalty is calculated as: depth_penalty = min(0.3, depth * 0.05). Top-level comments (depth=0) receive 0 penalty; depth=6+ is capped at 0.3
- [ ] priority_score is clamped to minimum 0.0 (depth_penalty cannot make it negative)
- [ ] The engagement score is normalized to a 0-1 range before being used in the priority formula (raw log values vary by post activity)
- [ ] Both engagement_score and depth_penalty values are computed for every ProcessedComment in the current run

## Technical Notes
- The engagement score formula is explicitly defined in PRD: log(upvotes + 1) x reply_count (Section 3.2.2 Phase 2)
- "reply_count" for a comment means the number of direct replies to that comment, available from PRAW's comment.replies attribute
- Depth penalty formula chosen: depth_penalty = min(0.3, depth * 0.05). Linear with cap at 0.3, matching the 30% engagement weight so deeply nested comments can at most zero out the engagement component
- Engagement normalization approach: normalize across all comments in the current batch (min-max or percentile) so the 0.3 weight in the priority formula is meaningful
- The engagement component feeds into the priority formula at 30% weight (story-002-007)
- PRD reference: Section 3.2.2 Phase 2 step 1 bullets 3-4

## Dependencies
- Depends on: story-002-003 (comments must be fetched with score, depth, and reply data)
- Blocks: story-002-007 (priority scoring needs engagement and depth components)
