---
id: story-002-007
epic: epic-002
title: Implement Priority Scoring and Selection
priority: high
story_points: [TBD]
source_requirements: [PIPE-008, PIPE-013, PIPE-014]
dependencies: [story-002-004, story-002-005, story-002-006]
blocks: [story-002-008]
---

# Story: Implement Priority Scoring and Selection

## Description
Combine the three scoring components (financial, trust, engagement) and depth penalty into the composite priority score using the weighted formula. Rank all comments by priority score descending, select the top 50 per post (approximately 500 total), and attach parent chain context to each selected comment for downstream AI analysis.

## Acceptance Criteria
- [ ] Composite priority_score is calculated using the exact formula: (financial_score * 0.4) + (author_trust * 0.3) + (engagement * 0.3) - depth_penalty
- [ ] All ~10,000 comments (1000 per post x 10 posts) are scored and ranked by priority_score in descending order
- [ ] Exactly the top 50 comments per post are selected for downstream AI analysis (approximately 500 total across all posts)
- [ ] If a post has fewer than 50 comments, all of that post's comments are selected
- [ ] Selected comments retain their parent_chain arrays (attached in story-002-003) for AI context
- [ ] The priority_score field on each selected ProcessedComment is populated with the computed composite value
- [ ] Non-selected comments are discarded from the processing pipeline (not passed to epic-003)

## Technical Notes
- The formula weights (0.4, 0.3, 0.3) are from PRD Section 3.2.2 Phase 2; consider reading from system_config for tunability
- Selection is per-post (top 50 from each post), not globally across all posts -- this ensures representation from all 10 posts
- Parent chain context was already built in story-002-003; this story just ensures it is preserved on selected comments
- The ~500 selected comments become the input to epic-003 (AI Sentiment Analysis)
- PRD reference: Section 3.2.2 Phase 2 steps 1-4

## Dependencies
- Depends on: story-002-004 (financial_score), story-002-005 (author_trust), story-002-006 (engagement + depth_penalty)
- Blocks: story-002-008 (storage needs the final selected and scored comments)
