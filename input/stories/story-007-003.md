---
id: story-007-003
epic: epic-007
title: Implement CRUD GET Endpoints
priority: high
story_points: [TBD]
source_requirements: [API-RUNS, API-RUN-STATUS, API-SIGNALS, API-SIGNAL-DETAIL, API-SIGNAL-COMMENTS, API-SIGNALS-HISTORY, API-PORTFOLIOS, API-PORTFOLIO-DETAIL, API-POSITIONS, API-POSITION-DETAIL, API-EVAL-PERIODS, API-PRICES, API-STATUS]
dependencies: [story-007-002]
blocks: [story-007-004]
---

# Story: Implement CRUD GET Endpoints

## Description
Implement all 15+ GET endpoints with filters, pagination, and computed convenience fields. Covers signals (with position_summary and skip_reason), positions (with position_exits and convenience fields), portfolios (with summary stats), runs (with timestamps and status), prices (yfinance daily close), status (system health), and evaluation periods. This is the largest Phase 7a story and enables frontend development against real endpoint contracts.

## Acceptance Criteria
- [ ] GET /signals returns paginated signals with filters: ticker, signal_type, date_from, date_to, portfolio_id; each signal includes position_summary and skip_reason
- [ ] GET /signals/{id} returns a single signal with full details
- [ ] GET /signals/{id}/comments returns paginated comments with AI annotations (sentiment badge, sarcasm flag, reasoning indicator, confidence) plus author_trust_score and ticker_sentiments
- [ ] GET /signals/history returns historical confidence grouped by ticker with parameters: ticker (optional), signal_type, days (default 14)
- [ ] GET /portfolios returns all 4 portfolios with summary: value, cash, open_position_count, total_pnl, total_pnl_pct
- [ ] GET /portfolios/{id} returns single portfolio with allocation breakdown
- [ ] GET /positions returns paginated positions with filters: portfolio_id, status, ticker, instrument_type, signal_type; includes position_exits and convenience fields (current_price, unrealized_return_pct, nearest_exit_distance_pct, hold_days, dte, premium_change_pct)
- [ ] GET /positions/{id} returns single position with exit strategy state and full position_exits history
- [ ] GET /runs returns paginated analysis runs with timestamps and status
- [ ] GET /runs/{id}/status returns polling-optimized response: status, current_phase, phase_label, progress_current, progress_total, results, warnings
- [ ] GET /evaluation-periods returns periods filtered by required portfolio_id parameter, including active and completed periods with metrics
- [ ] GET /prices/{ticker} returns daily close prices with days parameter (default 14), sourced from price_history table
- [ ] GET /status returns system health: current phase, emergence_active, emergence_days_remaining, open_position_count, last_run_completed_at, active_run_id
- [ ] All list endpoints use the standard response envelope with pagination (limit, offset, total)
- [ ] All list endpoints return empty data array (not error) when no records match filters
- [ ] Invalid filter values return VALIDATION_ERROR in error envelope format
- [ ] Invalid ID values on detail endpoints return NOT_FOUND error
- [ ] GET /positions response time is under 500ms for up to 40 open positions

## Technical Notes
- This is a large story (may warrant splitting during task decomposition) but is kept together because all GET endpoints share patterns and infrastructure
- Convenience fields (unrealized_return_pct, nearest_exit_distance_pct, hold_days, dte, premium_change_pct) are computed on-demand per position, not stored
- skip_reason is dynamically computed per-portfolio: bearish_long_only is reliably computable from stored data; other reasons (no_valid_strike, insufficient_cash) return generic "not eligible"
- position_summary on signals: count of associated positions across portfolios, status summary
- Evaluation periods require portfolio_id as a mandatory filter parameter
- GET /prices/{ticker} reads from price_history table (populated by epic-006), not live yfinance calls
- Optimize with indexed queries; positions table has 28+ columns so SELECT specific fields

## Dependencies
- Depends on: story-007-002 (response envelope and pagination)
- Blocks: story-007-004 (seed data needs endpoints to verify against)
