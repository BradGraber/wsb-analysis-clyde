---
id: story-005-006
epic: epic-005
title: Implement Options Strike Selection
priority: high
story_points: [TBD]
source_requirements: [FR-037]
dependencies: [epic-001]
blocks: [story-005-007]
---

# Story: Implement Options Strike Selection

## Description
Implement the options strike selection function that fetches the Schwab options chain for a given ticker, filters by DTE (14-21 days), targets delta of approximately 0.30, and checks tolerance ranges ([+0.15, +0.50] for calls, [-0.50, -0.15] for puts). Select the closest valid strike to the target delta. If no valid strike exists, skip the position and log a warning. This function must be implemented as a standalone reusable module, shared with epic-009 prediction creation.

## Acceptance Criteria
- [ ] Schwab options chain is fetched for the given ticker using the epic-001 Schwab client
- [ ] Expirations are filtered to 14 <= DTE <= 21, preferring closest to 17 DTE
- [ ] For calls: strikes are sorted by distance from +0.30 delta, filtered to delta in [+0.15, +0.50]
- [ ] For puts: strikes are sorted by distance from -0.30 delta, filtered to delta in [-0.50, -0.15]
- [ ] The closest valid strike to target delta is selected and returned with contract_symbol, strike_price, expiration_date, delta, and current premium (mark price)
- [ ] If no valid strike exists within tolerance range, function returns None and logs a warning (no error raised)
- [ ] When two expirations are equidistant from 17 DTE (e.g., 15 DTE and 19 DTE), the earlier expiration is preferred
- [ ] Function is implemented as a standalone importable module/function, not coupled to position management (reusable by epic-009)

## Technical Notes
- FR-037: Options parameters with delta-based strike selection, 14-21 DTE, 2% portfolio sizing
- Schwab options chain API returns expirations with individual strikes and greeks (delta, gamma, theta, vega)
- DTE preference: among valid expirations (14-21), prefer the one closest to 17 days
- Delta filtering: absolute distance from 0.30 target, within tolerance band
- The function signature should accept: ticker, option_type ('call'/'put'), and return strike info or None
- This is the shared strike selection function, reused by prediction creation (story-009-003). Not to be confused with the MonitoredInstrument Protocol (story-006-015), which is a separate interface for exit evaluation.
- VCR.py cassettes should be used for testing Schwab API responses per project conventions

## Dependencies
- Depends on: epic-001 (Schwab client for options chain API)
- Blocks: story-005-007 (position opening needs strike info for options)
