---
id: story-006-014
epic: epic-006
title: Implement Token Health Check Endpoint
priority: medium
story_points: [TBD]
source_requirements: [INT-SCHWAB-REFRESH]
dependencies: [epic-001]
blocks: []
---

# Story: Implement Token Health Check Endpoint

## Description
Implement a GET /auth/status endpoint that returns the current Schwab OAuth token health: access token expiration timestamp, refresh token expiration timestamp, and a warning flag if either token is less than 24 hours from expiry. This endpoint enables the dashboard to display token health status.

## Acceptance Criteria
- [ ] GET /auth/status endpoint returns JSON with access_token_expires_at and refresh_token_expires_at timestamps
- [ ] Response includes a boolean warning flag (warning: true) when either token expires within 24 hours
- [ ] Response includes a human-readable status field (e.g., 'healthy', 'warning', 'expired')
- [ ] Endpoint returns 200 with status 'expired' if tokens are expired (does not return error status code)
- [ ] If the token file does not exist (Schwab setup not yet run), endpoint returns 200 with status='not_configured' and both expiration timestamps as null
- [ ] Endpoint returns 503 if token storage is inaccessible
- [ ] Response conforms to the standard API envelope format (from epic-007)

## Technical Notes
- INT-SCHWAB-REFRESH: Schwab OAuth tokens have 30-minute access token and 7-day refresh token lifetimes.
- Token storage uses chmod 600 file-based storage (from epic-001 security decisions).
- This endpoint reads token metadata without triggering a refresh.
- Warning threshold of 24 hours gives operators time to manually re-authenticate if the refresh token is about to expire.
- The endpoint is lightweight (no external API calls) and can be polled by the dashboard.
- This was identified as a security recommendation in qc-sec-003.

## Dependencies
- Depends on: epic-001 (Schwab client and token storage infrastructure)
- Blocks: none
