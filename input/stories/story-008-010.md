---
id: story-008-010
epic: epic-008
title: Implement Page Reload Recovery and Dashboard Indicators
priority: high
story_points: [TBD]
source_requirements: [UI-RELOAD-RECOVERY, UI-LAST-ANALYSIS, UI-MARKET-HOURS, UI-EMERGENCE, UI-EMPTY-STATES, UI-BACKEND-ERROR, UI-REFRESH]
dependencies: [story-008-009]
blocks: [story-008-013]
---

# Story: Implement Page Reload Recovery and Dashboard Indicators

## Description
Implement page reload recovery that checks GET /status on mount and resumes progress polling if an active run is detected. Also implement the suite of dashboard indicators: "Last analysis: [relative time]" in the header, market hours indicator (client-side ET calculation), emergence countdown widget, empty state messages for all views, backend connectivity error banner with retry, and "Refresh Prices" button.

## Acceptance Criteria
- [ ] On page mount, GET /status is called; if active_run_id is present, progress polling resumes at the current phase (using story-008-009 progress indicator)
- [ ] "Last analysis: [relative time]" is displayed in the header, computed from last_run_completed_at in GET /status (e.g., "Last analysis: 2 hours ago")
- [ ] Market hours indicator in header: when market is closed, displays "Market closed -- prices as of [last close time]" (client-side US Eastern Time calculation, Mon-Fri 9:30 AM - 4:00 PM ET)
- [ ] Emergence countdown widget: Days 1-7 shows yellow "Activates in N days", Day 8+ shows green "Active"
- [ ] Empty state messages: Signals tab ("No analysis runs yet" or "No signals for this type"), Positions tab ("No open positions"), Performance tab ("No evaluation periods", "Active period: Day N of 30", "No positions in period")
- [ ] Backend connectivity error: persistent banner "Unable to connect to backend" with Retry button; individual request failures show inline error with retry
- [ ] "Refresh Prices" button fetches live prices for open positions and triggers UI update
- [ ] Refresh Prices button shows a loading spinner during fetch, calls GET /positions?portfolio_id=X to refresh position data, and displays a toast on success or error

## Technical Notes
- Reload recovery: `onMounted(() => { const status = await fetchStatus(); if (status.active_run_id) startPolling(status.active_run_id); })`
- Market hours: compute in utility function, account for weekends and US holidays (basic: just weekdays, no holiday calendar needed for Phase 1)
- Emergence countdown: compute from signal_date, emergence period is 7 days per PRD
- Empty states: create a reusable `<EmptyState :message="msg" :icon="icon" />` component
- Backend error detection: wrap all API calls in a global error handler; if fetch fails with network error, show banner
- Retry mechanism: banner retry re-attempts GET /status; inline retry re-attempts the specific failed request
- "Refresh Prices" button: calls a backend endpoint or refetches position data to get updated current_price values
- Last analysis time: use a relative time library (e.g., dayjs relativeTime plugin) or compute manually

## Dependencies
- Depends on: story-008-009 (progress indicator that reload recovery resumes)
- Blocks: story-008-013 (error injection tests exercise the error banner and recovery patterns)
