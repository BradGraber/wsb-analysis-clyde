---
id: task-007-003-04
story: story-007-003
title: Implement GET /runs, /runs/{id}/status, /prices/{ticker}, and /status endpoints
complexity: 2
---

# Task: Implement GET /runs, /runs/{id}/status, /prices/{ticker}, and /status endpoints

## Description
Implement the remaining GET endpoints: analysis runs list, run status polling endpoint, price history for sparklines, and system health status. The run status endpoint is optimized for frontend polling (10s intervals). Price history reads from the price_history table (not live yfinance). System status provides a dashboard health overview. Phase 7a task (Weeks 2-3).

## Acceptance Criteria
- [ ] GET /runs returns paginated analysis runs with timestamps (started_at, completed_at) and status
- [ ] GET /runs/{id}/status returns polling-optimized response: status, current_phase, phase_label, progress_current, progress_total, results summary, warnings array
- [ ] Returns NOT_FOUND for invalid run ID
- [ ] GET /prices/{ticker} returns daily close prices with `days` parameter (default 14); data sourced from price_history table
- [ ] GET /prices/{ticker} returns empty array for unknown tickers (not an error)
- [ ] GET /status returns system health: current pipeline phase (if running), emergence_active flag, emergence_days_remaining, open_position_count, last_run_completed_at, active_run_id (null if none)
- [ ] All list endpoints use response envelope with pagination

## Technical Notes
- GET /runs/{id}/status is the frontend polling target; keep it lightweight (minimal joins)
- results field on run status: summary of completed pipeline output (signal count, position count, etc.) -- populated on completion
- warnings field: JSON array from analysis_runs.warnings column, deserialized on read
- GET /prices/{ticker}: simple SELECT from price_history WHERE ticker = ? ORDER BY date DESC LIMIT days
- GET /status aggregates from multiple tables: analysis_runs (latest), positions (open count), system_config (emergence)
- emergence_active and emergence_days_remaining come from system_config table
- Create `src/api/routes/runs.py` and `src/api/routes/system.py` router modules (or combine into one)

## Dependencies
- Depends on: task-007-002-01, task-007-002-02 (response envelope, pagination, error handlers)
- Blocks: task-007-004-01 (seed data should verify these endpoints)
