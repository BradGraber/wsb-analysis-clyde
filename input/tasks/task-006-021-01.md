---
id: task-006-021-01
story: story-006-021
title: Write prediction edge case tests (5 tests)
complexity: 2
---

# Task: Write prediction edge case tests (5 tests)

## Description
Write 5 unit tests covering prediction monitoring edge cases: (1) missed expiration where DTE < 0 between runs triggers immediate resolution, (2) Schwab outage causing stale current_premium with no exit on stale data alone, (3) zero-premium options handled without division-by-zero, (4) stale peak_premium never overwritten with lower value, (5) already-resolved predictions skipped entirely. Use carefully constructed edge-case fixtures.

## Acceptance Criteria
- [ ] Test 1: DTE < 0 (missed expiration) immediately resolves with exit_reason='expiration', quantity_pct=1.0
- [ ] Test 2: Schwab outage retains stale current_premium, no exit triggered on stale data, warning logged
- [ ] Test 3: Zero-premium (current_premium=0.0) resolves as stop-loss without division-by-zero
- [ ] Test 4: peak_premium never overwritten with lower value (monotonically increasing)
- [ ] Test 5: status='resolved' predictions skipped, no duplicate processing

## Technical Notes
- Test 1: expired-past-expiration path in PIPE-058
- Test 2: graceful degradation on Schwab unavailability
- Test 3: worthless option edge case
- Test 4: regression test for peak_premium monotonicity
- Test 5: idempotent monitoring verification
- Use pytest with edge-case fixtures

## Dependencies
- Depends on: task-006-019-02 (prediction monitoring implementation)
- Blocks: none
