---
id: task-004-002-01
story: story-004-002
epic: epic-004
title: Implement Quality signal detection algorithm with unanimity check
complexity: 2
---

# Task: Implement Quality signal detection algorithm with unanimity check

## Description
Create a `detect_quality_signal(ticker, signal_date, comments, config, author_trust_scores)` function that filters comments for substantive reasoning (has_reasoning=true, sarcasm_detected=false, ai_confidence >= quality_min_confidence), counts distinct qualifying users, checks unanimity on per-ticker sentiment direction, and returns signal metadata when at least quality_min_users distinct users meet all criteria with unanimous direction. All thresholds read from config dict (sourced from system_config). Calls calculate_signal_confidence for the confidence score. References FR-001, FR-015, FR-017, PIPE-025.

## Acceptance Criteria
- [ ] Comments filtered by has_reasoning=true AND sarcasm_detected=false AND ai_confidence >= quality_min_confidence (default 0.6)
- [ ] ai_confidence = 0.6 exactly qualifies (inclusive boundary >= not >)
- [ ] Distinct users counted among qualifying comments (by author field)
- [ ] Direction unanimity checked using per_ticker_sentiment: ALL qualifying comments must agree on bullish OR all on bearish
- [ ] Signal fires when distinct_users >= quality_min_users (default 2) AND unanimity achieved
- [ ] Signal direction set to the unanimous sentiment direction
- [ ] Signal does NOT fire when qualifying users disagree on direction, even if user count meets threshold
- [ ] All thresholds (quality_min_confidence, quality_min_users) read from config dict, not hardcoded
- [ ] When signal fires, calls calculate_signal_confidence with signal_type="quality" and returns confidence in result
- [ ] Returns None or empty result when signal criteria not met

## Technical Notes
- Unanimity means 100% agreement -- a single dissenting qualifying comment disqualifies
- Volume score for Quality signals uses distinct user count, alignment score is always 1.0
- The function returns a signal metadata dict containing: direction, confidence, user_count, comment_count, contributing_comment_ids
- Config dict should contain quality_min_confidence and quality_min_users keys
- Filter first, then check unanimity among the filtered set

## Dependencies
- Depends on: task-004-001-01 (comment aggregation), task-004-004-01 (confidence calculation)
- Blocks: task-004-006-01
