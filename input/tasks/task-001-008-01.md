---
id: task-001-008-01
story: story-001-008
epic: epic-001
title: Implement retry_with_backoff utility with exponential backoff
complexity: 2
---

# Task: Implement retry_with_backoff utility with exponential backoff

## Description
Create a `src/errors.py` module containing a `retry_with_backoff(fn, max_retries=3, base_delay=1.0, max_delay=30.0, retryable_exceptions=(Exception,))` function. It executes the callable fn, and on failure with a retryable exception type, waits with exponential backoff (base_delay * 2^attempt) capped at max_delay before retrying. Returns the result on success or raises the final exception after max_retries exhausted. Include unit tests.

## Acceptance Criteria
- [ ] `retry_with_backoff(fn, max_retries, base_delay, max_delay, retryable_exceptions)` works as described
- [ ] Exponential backoff: delays are base_delay, base_delay*2, base_delay*4, ... capped at max_delay
- [ ] When backoff exceeds max_delay, delay is capped (e.g., 64s -> 30s)
- [ ] Returns fn() result on success (including success after retries)
- [ ] Raises the final exception after max_retries exhausted
- [ ] Only retries on exception types in retryable_exceptions; other exceptions propagate immediately
- [ ] Unit test: successful call returns result without retry
- [ ] Unit test: call succeeds on 2nd attempt after 1 retry
- [ ] Unit test: call fails after max_retries and raises final exception
- [ ] Unit test: non-retryable exception propagates immediately without retry

## Technical Notes
- Use time.sleep() for delays (tests can mock this)
- Consider adding jitter (random offset) to prevent thundering herd, but keep simple for now
- This implements the Tier 2 error boundary pattern from PRD Section 3.6.4
- Consumed by epic-002 (Reddit/OpenAI), epic-005/006 (Schwab), epic-009 (author trust)

## Files to Create/Modify
- `src/errors.py` (new module)
- `tests/test_errors.py` (new test file)
