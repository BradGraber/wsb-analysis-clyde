---
id: task-003-001-02
story: story-003-001
title: Implement monthly cost tracking with $60 warning threshold
complexity: 2
---

# Task: Implement monthly cost tracking with $60 warning threshold

## Description
Add cost tracking to the OpenAI client that accumulates token usage across API calls, converts to dollar amounts using GPT-4o-mini pricing rates, and logs a warning when the monthly running total exceeds $60. The monthly counter resets when the calendar month changes between runs. Cost data is logged with each API call for observability.

## Acceptance Criteria
- [ ] Each API call logs token usage (prompt_tokens, completion_tokens) and estimated cost via structlog
- [ ] Running monthly total is maintained in memory across calls within a pipeline run
- [ ] Cost estimation uses GPT-4o-mini pricing: input tokens at $0.15/1M tokens, output tokens at $0.60/1M tokens (or current published rates stored as constants)
- [ ] When monthly total exceeds $60, a WARNING-level log is emitted: "Monthly AI cost exceeded $60 threshold: ${current_total:.2f}"
- [ ] Monthly counter resets when the calendar month changes (tracked by storing the current month; reset on first call of a new month)
- [ ] The $60 threshold is a log warning only; no enforcement or pipeline halt
- [ ] Unit test: cost accumulates across multiple calls
- [ ] Unit test: warning logged when threshold exceeded
- [ ] Unit test: counter resets on month boundary

## Technical Notes
- Pricing rates should be module-level constants for easy updates (GPT4O_MINI_INPUT_RATE, GPT4O_MINI_OUTPUT_RATE)
- Monthly tracking can use a simple CostTracker class with (current_month, running_total)
- Expected cost: ~$0.10 per 500 comments (~$45/month at 3 runs/day)
- PRD reference: NFR-009

## Dependencies
- Depends on: task-003-001-01 (client returns token usage counts)
- Blocks: none
