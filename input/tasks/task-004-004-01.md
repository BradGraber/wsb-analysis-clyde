---
id: task-004-004-01
story: story-004-004
epic: epic-004
title: Implement 4-factor weighted confidence calculation with signal-type branching
complexity: 2
---

# Task: Implement 4-factor weighted confidence calculation with signal-type branching

## Description
Create a `calculate_signal_confidence(signal_type, contributing_comments, config, author_trust_scores)` function implementing the 4-factor weighted formula: volume_score * w1 + alignment_score * w2 + avg_ai_confidence * w3 + avg_author_trust * w4. Volume and alignment score formulas differ by signal type (Quality vs Consensus). All weights are read from system_config via the config dict. Author trust scores default to 0.5 for unknown authors (TRUST-COLD-START). References FR-040, PIPE-027.

## Acceptance Criteria
- [ ] Confidence = volume_score * w1 + alignment_score * w2 + avg_ai_confidence * w3 + avg_author_trust * w4
- [ ] Default weights are 0.25, 0.25, 0.30, 0.20 read from system_config (keys: confidence_weight_volume, confidence_weight_alignment, confidence_weight_ai_confidence, confidence_weight_author_trust)
- [ ] Quality volume score: min(1.0, distinct_users / (quality_min_users * 3))
- [ ] Consensus volume score: min(1.0, comment_count / (consensus_min_comments * 3))
- [ ] Quality alignment score is always 1.0
- [ ] Consensus alignment score: clamp((actual_alignment - min_alignment) / (1.0 - min_alignment), 0.0, 1.0)
- [ ] avg_ai_confidence is mean of ai_confidence values from contributing comments
- [ ] avg_author_trust is mean of author trust_score values, using 0.5 for authors not in the authors table
- [ ] Final confidence is a float in [0.0, 1.0]

## Technical Notes
- Function accepts signal_type ("quality" or "consensus") to branch on volume/alignment calculation
- Weights should be read once per pipeline run from system_config, passed in as a config dict
- The volume denominator uses the signal-type-specific threshold * 3 (e.g., quality_min_users=2 -> denominator=6)
- Consensus alignment normalization: when actual_alignment equals min_alignment, score is 0.0; when 1.0, score is 1.0
- Author trust lookup: pass a dict of {author_username: trust_score}; missing authors get 0.5
- This is a pure calculation function with no database access -- all data passed in via parameters

## Dependencies
- Depends on: task-004-001-01 (comment aggregation provides input data)
- Blocks: task-004-002-01, task-004-003-01
