---
id: task-002-001-02
story: story-002-001
title: Implement hot posts fetching with ProcessedPost construction
complexity: 2
---

# Task: Implement hot posts fetching with ProcessedPost construction

## Description
Add a `fetch_hot_posts(reddit: asyncpraw.Reddit, subreddit_name: str = "wallstreetbets", limit: int = 10) -> list[ProcessedPost]` function to `src/reddit.py`. Fetches the top N hot posts from the specified subreddit, maps each Async PRAW Submission to a ProcessedPost object with all 8 fields (image_url, image_analysis, and comments initialized to defaults). Catches Async PRAW exceptions and raises domain errors for Tier 1 handling.

## Acceptance Criteria
- [ ] `fetch_hot_posts()` returns a list of ProcessedPost objects for up to `limit` hot posts
- [ ] Each ProcessedPost has: reddit_id, title, selftext, upvotes, total_comments populated from Async PRAW Submission; image_url=None, image_analysis=None, comments=[]
- [ ] If fewer than `limit` posts are available, returns all available posts without error
- [ ] Async PRAW exceptions during fetch are caught, logged via structlog with exception details, and re-raised for HTTP 503 per ERR-REDDIT-OUTAGE
- [ ] Subreddit name defaults to "wallstreetbets" but is configurable via parameter
- [ ] Unit test: mock Async PRAW subreddit.hot() returning 3 posts, verify 3 ProcessedPost objects with correct field mapping
- [ ] Unit test: Async PRAW exception during fetch is caught and logged

## Technical Notes
- ProcessedPost is defined in story-002-008 (task-002-008-01); this task imports and uses it
- The `selftext` field may be empty string for link posts (not None)
- Async PRAW's subreddit.hot(limit=N) returns a generator; consume it into a list
- PRD reference: PIPE-002, FR-010, Appendix D.2

## Dependencies
- Depends on: task-002-001-01 (Reddit client), task-002-008-01 (ProcessedPost dataclass)
- Blocks: task-002-002-01, task-002-003-01
