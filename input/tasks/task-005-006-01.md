---
id: task-005-006-01
story: story-005-006
title: Implement options chain fetch and DTE filtering
complexity: 2
---

# Task: Implement options chain fetch and DTE filtering

## Description
Create the first half of the standalone options strike selection module: fetch the Schwab options chain for a given ticker and filter expirations to the 14-21 DTE window, preferring the expiration closest to 17 DTE. When two expirations are equidistant from 17 DTE, prefer the earlier one. This function is the reusable foundation shared with epic-009 prediction creation.

## Acceptance Criteria
- [ ] Fetches full options chain from Schwab API using the epic-001 Schwab client
- [ ] Filters expirations to 14 <= DTE <= 21 (calendar days from today to expiration)
- [ ] Selects the expiration closest to 17 DTE target
- [ ] When two expirations are equidistant (e.g., 15 DTE and 19 DTE), selects the earlier expiration
- [ ] Returns the selected expiration's full strike data (all strikes with greeks) for downstream delta filtering
- [ ] Returns None with warning log if no expirations fall within 14-21 DTE window
- [ ] Function is standalone/importable, not coupled to position management module
- [ ] Unit tests with VCR.py cassettes: valid chain, no valid DTE, equidistant preference, single valid expiration

## Technical Notes
- FR-037 requirement (first half)
- Schwab options chain API returns expirations as a dict with expiration dates as keys, each containing a list of strikes with greeks
- DTE calculation: (expiration_date - today).days where today is the current date in ET
- This module will live in a shared location (e.g., `utils/options.py` or `services/strike_selection.py`) for reuse by epic-009
- VCR.py cassettes should capture realistic Schwab options chain responses

## Dependencies
- Depends on: epic-001 Schwab client (must be available for API calls)
- Blocks: task-005-006-02
