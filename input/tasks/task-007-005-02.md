---
id: task-007-005-02
story: story-007-005
title: Add 60-minute hard timeout and 30-minute soft warning to pipeline runner
complexity: 2
---

# Task: Add 60-minute hard timeout and 30-minute soft warning to pipeline runner

## Description
Extend the background thread pipeline runner with timeout enforcement: a 30-minute soft warning logged at WARNING level and a 60-minute hard timeout that sets the run to 'failed'. The hard timeout should allow the current pipeline phase to complete before terminating, and must handle the case where a database transaction is in progress. Phase 7b task (Weeks 10-12).

## Acceptance Criteria
- [ ] Elapsed time is tracked from the start of the pipeline run
- [ ] At 30 minutes elapsed, a WARNING log is emitted: "Pipeline has been running for 30 minutes" with run_id
- [ ] At 60 minutes elapsed, the pipeline is terminated: status set to 'failed' with error "Pipeline exceeded 60-minute timeout"
- [ ] Hard timeout checks occur at phase boundaries (between phases, not mid-phase), allowing the current phase to finish
- [ ] If timeout fires during a database transaction, the transaction is rolled back before setting status='failed'
- [ ] Timeout enforcement does not use signals (not available in threads); uses elapsed time checks at phase boundaries
- [ ] Soft warning does not stop execution; pipeline continues

## Technical Notes
- Implementation approach: check elapsed time at the start of each phase boundary in the orchestrator loop
- Alternative: use `threading.Timer` for the 30-min warning (fire-and-forget log), and check elapsed time >= 60min between phases
- The soft warning is a simple log; the hard timeout sets a flag that the orchestrator loop checks before starting the next phase
- Edge case: if a single phase takes >30 minutes, the timeout will only fire after that phase completes
- NFR-004: "warn if exceeded 30 min, hard fail at 60 min"

## Dependencies
- Depends on: task-007-005-01 (base orchestrator to extend)
- Blocks: task-007-006-01 (POST /analyze needs complete orchestration)
