---
id: task-004-005-01
story: story-004-005
epic: epic-004
title: Implement emergence detection with 7-day historical baseline and warmup logic
complexity: 2
---

# Task: Implement emergence detection with 7-day historical baseline and warmup logic

## Description
Create a `detect_emergence(conn, ticker, signal_date)` function that queries the prior 7 calendar days of mention history for a ticker from comment_tickers/comments tables and determines emergence status. A ticker is "emerging" when it was cold (fewer than 3 mentions in prior 7 days) and is now hot (>= 13 current mentions from >= 8 distinct users). During warmup (system has fewer than 7 days of history), returns None. After warmup, returns True/False. References FR-019, FR-020, FR-032, FR-033, PIPE-028.

## Acceptance Criteria
- [ ] Queries prior 7 calendar days of mention history per ticker from comment_tickers joined with comments
- [ ] Emergence fires when prior_mentions < 3 AND current_mentions >= 13 AND current_distinct_users >= 8
- [ ] During warmup (fewer than 7 days of analysis run history), returns None (not False)
- [ ] After warmup (day 8+), returns True when criteria met, False when not met
- [ ] Emergence detection runs for every ticker in current aggregation, not just those with fired signals
- [ ] Emergence has no effect on position sizing or signal confidence in Phase 1 (metadata only)
- [ ] Tickers with emergence but no fired signal: log at INFO level, do not persist to database

## Technical Notes
- "Prior 7 days" = 7 calendar days before signal_date; query analysis runs with dates in that range
- prior_mentions = count of comment_tickers rows for this ticker linked to comments in prior 7 days' runs
- current_distinct_users = count of unique comment authors mentioning this ticker in the current run
- Warmup detection: check if the earliest analysis_run date is at least 7 days before signal_date
- This function requires database access (unlike the pure calculation functions) for historical queries
- FR-033: emergence flag is stored on signal record but has no sizing effect in Phase 1
- Consider caching the warmup check (it is the same for all tickers in a single run)

## Dependencies
- Depends on: task-004-001-01 (current aggregation data), epic-001 (schema)
- Blocks: task-004-006-01
