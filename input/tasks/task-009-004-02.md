---
id: task-009-004-02
story: story-009-004
title: Implement EMA-based author accuracy update with cold start handling
complexity: 2
---

# Task: Implement EMA-based author accuracy update with cold start handling

## Description
For each resolved prediction (from task-009-004-01), update the author's avg_sentiment_accuracy via EMA: new_value = (1 - accuracy_ema_weight) * old_value + accuracy_ema_weight * (1.0 if is_correct else 0.0), where accuracy_ema_weight is read from system_config (default 0.30). Handle cold start: when author.avg_sentiment_accuracy is NULL (first-ever resolution), set directly to 1.0 (correct) or 0.0 (incorrect), not via EMA. Excluded predictions (hitl_override='excluded') skip accuracy update entirely. When multiple predictions resolve for the same author in one cycle, apply EMA updates sequentially. After accuracy update, recalculate trust score. PRD Appendix F.4.2-F.4.3 lines 3045-3077.

## Acceptance Criteria
- [ ] EMA update: new = (1 - accuracy_ema_weight) * old + accuracy_ema_weight * (1.0 if correct else 0.0)
- [ ] accuracy_ema_weight read from system_config (default 0.30), not hardcoded
- [ ] Cold start: when avg_sentiment_accuracy is NULL, set directly to 1.0 or 0.0 (no EMA blend)
- [ ] Excluded predictions (hitl_override='excluded') do not modify avg_sentiment_accuracy at all
- [ ] Multiple predictions for same author applied sequentially (each update uses result of previous)
- [ ] After all accuracy updates for an author, trust score is recalculated via calculate_trust_score
- [ ] Unit tests cover: EMA update with known values, cold start direct-set, excluded skip, sequential multi-prediction EMA

## Technical Notes
- The sequential application order matters: if author has 3 predictions resolving in one cycle, apply EMA 3 times in sequence (order by resolved_at or prediction id)
- EMA formula: 70% old + 30% new with default alpha=0.30
- After accuracy update, the trust score changes because the accuracy component (50% weight) is updated
- This is a database UPDATE to authors.avg_sentiment_accuracy followed by trust score recalculation
- Trust score recalculation calls calculate_trust_score from task-009-001-01

## Dependencies
- Depends on: task-009-004-01 (provides is_correct and excluded flags), task-009-001-01 (trust score recalculation)
- Blocks: none (story-009-007 tests depend on story-009-004 overall)
