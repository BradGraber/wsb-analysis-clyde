---
id: task-006-017-01
story: story-006-017
title: Write options exit condition unit tests (Tests 1-6)
complexity: 3
---

# Task: Write options exit condition unit tests (Tests 1-6)

## Description
Write 6 unit tests covering all options exit conditions: (1) expiration protection at DTE=2, (2) premium stop-loss at -50%, (3) premium take-profit at +100% exiting 50% contracts, (4) partial exit correctly decrements contracts_remaining and sets trailing_stop_active, (5) trailing stop at peak_premium * 0.70, (6) time stop at 10 days. Use hand-written fixtures with mock premium data and mock options position objects.

## Acceptance Criteria
- [ ] Test 1: Expiration at DTE=2, exits 100% contracts
- [ ] Test 2: Premium stop-loss at current_premium <= entry_premium * 0.50, exits 100%
- [ ] Test 3: Premium take-profit at current_premium >= entry_premium * 2.0, exits 50%
- [ ] Test 4: Partial exit decrements contracts_remaining, sets trailing_stop_active=TRUE
- [ ] Test 5: Trailing stop at current_premium <= peak_premium * 0.70, exits remaining
- [ ] Test 6: Time stop at hold_days >= 10, exits 100%
- [ ] All tests use pytest with mock options positions and premium data

## Technical Notes
- Tests isolate individual options exit condition functions
- Mock positions need entry_premium, contracts_remaining, expiration_date, peak_premium
- Each test verifies exit_reason, exit_price, and quantity assertions
- Tests 1-6 are the core happy-path tests for options exits

## Dependencies
- Depends on: task-006-005-01, task-006-006-01, task-006-006-02, task-006-007-01
- Blocks: none
