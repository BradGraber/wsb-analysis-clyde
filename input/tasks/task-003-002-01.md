---
id: task-003-002-01
story: story-003-002
title: Define system prompt and user prompt template with context formatting
complexity: 2
---

# Task: Define system prompt and user prompt template with context formatting

## Description
Create an `src/prompts.py` module containing the static system prompt and the parameterized user prompt template for GPT-4o-mini sentiment analysis. The system prompt matches PRD Appendix E.2 verbatim (WSB communication style, sarcasm, meme definitions, four analysis tasks). The user prompt template matches Appendix E.3 with placeholders for post_title, image_description, parent_chain_formatted, author, author_trust, and comment_body, including the exact JSON response structure and three rules.

## Acceptance Criteria
- [ ] SYSTEM_PROMPT constant matches PRD Appendix E.2 content: WSB communication style, meme language definitions, four analysis tasks
- [ ] User prompt template includes placeholders for: post_title, image_description, parent_chain_formatted, author, author_trust, comment_body
- [ ] User prompt includes the exact JSON response structure from E.3 with all 7 fields
- [ ] User prompt includes the three response rules (ticker_sentiments per ticker, sentiment matches single-ticker, reasoning_summary null when has_reasoning false)
- [ ] Confidence scoring guidelines from E.6 are embedded in the system prompt: base 0.5 with modifiers
- [ ] When image_description is None or empty, the image context line is omitted entirely from the rendered prompt
- [ ] `build_user_prompt(post_title, image_description, parent_chain, author, author_trust, comment_body)` function renders the template with provided values
- [ ] Unit test: prompt renders with all fields populated
- [ ] Unit test: prompt omits image context when image_description is None

## Technical Notes
- Store prompts as module-level string constants or templates
- Use f-strings or string.Template for variable injection
- The system prompt is static; user prompt varies per comment
- PRD reference: Appendix E.2 (system prompt), E.3 (user prompt), E.6 (confidence scoring)

## Dependencies
- Depends on: none (pure string templates)
- Blocks: task-003-002-02
