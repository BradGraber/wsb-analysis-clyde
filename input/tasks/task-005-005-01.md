---
id: task-005-005-01
story: story-005-005
title: Implement stocks long-only filter with bearish signal handling
complexity: 2
---

# Task: Implement stocks long-only filter with bearish signal handling

## Description
Implement the Phase 1 long-only constraint that filters the target portfolio list for bearish signals. When direction is 'bearish', remove stock portfolios (stocks_quality, stocks_consensus) from the target list while keeping options portfolios (which will open puts). Bullish signals pass through unmodified. Handle dual-signal scenarios where both Quality and Consensus fire on the same ticker with potentially conflicting directions.

## Acceptance Criteria
- [ ] Bearish signals: stock portfolios removed from target list, options portfolios retained
- [ ] Bullish signals: all target portfolios retained (no filtering)
- [ ] Log message emitted when stock portfolio skipped: "Bearish signal: stock position skipped (long-only Phase 1), options position opened."
- [ ] When both Quality and Consensus fire on same ticker, each signal is filtered independently based on its own direction
- [ ] Conflicting directions (Quality=bullish, Consensus=bearish) result in valid independent portfolio assignments
- [ ] Long-only toggle is checked from system_config for future Phase 2 short-selling support
- [ ] Unit tests: bullish passthrough, bearish filtering, dual signals with conflicting directions

## Technical Notes
- FR-036 and PIPE-034 requirements
- This filter runs after target portfolio determination (task-005-003-01) but before position opening
- The filter modifies the target portfolio list in-place or returns a filtered copy
- Phase 2 may add short selling; design as a toggleable filter via system_config key `stocks_long_only` (default true)
- For bearish signals, options_quality/options_consensus still open puts (option_type='put' set downstream)

## Dependencies
- Depends on: task-005-003-01 (target portfolio list as input)
- Blocks: none (feeds into task-005-007-01)
