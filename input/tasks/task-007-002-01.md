---
id: task-007-002-01
story: story-007-002
title: Create Pydantic response/error models and wrap_response utility
complexity: 2
---

# Task: Create Pydantic response/error models and wrap_response utility

## Description
Define Pydantic models for the standard response envelope (`{data, meta: {timestamp, version}}`), error envelope (`{error: {code, message}}`), and pagination parameters (`limit`, `offset`). Create a `wrap_response(data, total=None)` utility function that all endpoints will call to produce consistent responses. Define all 7 error code constants. Phase 7a task (Weeks 2-3).

## Acceptance Criteria
- [ ] `ResponseEnvelope` Pydantic model with `data` (Any) and `meta` (MetaModel with `timestamp: str`, `version: str`)
- [ ] `ErrorEnvelope` Pydantic model with `error` (ErrorDetail with `code: str`, `message: str`)
- [ ] `PaginationParams` dependency class accepting `limit` (default 50, max 100) and `offset` (default 0) as query parameters
- [ ] `wrap_response(data, total=None)` returns dict with envelope structure; includes `meta.total` when total is provided
- [ ] 7 error code constants defined: VALIDATION_ERROR, NOT_FOUND, ANALYSIS_ALREADY_RUNNING, REDDIT_API_ERROR, OPENAI_API_ERROR, SCHWAB_AUTH_ERROR, DATABASE_ERROR
- [ ] Error codes map to HTTP status codes: VALIDATION_ERROR=422, NOT_FOUND=404, ANALYSIS_ALREADY_RUNNING=409, *_API_ERROR=502, DATABASE_ERROR=500
- [ ] `raise_api_error(code, message, status_code)` helper for consistent error raising
- [ ] Version string hardcoded as "1.0"

## Technical Notes
- PaginationParams can be a FastAPI Depends() injectable: `def pagination(limit: int = Query(50, le=100), offset: int = Query(0, ge=0))`
- `wrap_response` injects `meta.timestamp` as UTC ISO-8601 at call time
- Error codes should be an enum or string constants in a dedicated module (e.g., `src/api/models.py` or `src/api/schemas.py`)
- These models also generate OpenAPI/Swagger documentation automatically

## Dependencies
- Depends on: task-007-001-01 (FastAPI app must exist)
- Blocks: task-007-002-02, task-007-003-01 through task-007-003-04
