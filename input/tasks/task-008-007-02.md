---
id: task-008-007-02
story: story-008-007
title: Implement manual close popover with reason, quantity, and confirmation flow
complexity: 2
---

# Task: Implement manual close popover with reason, quantity, and confirmation flow

## Description
Add a "Close" button on open positions that triggers an inline popover (UI-MANUAL-CLOSE). The popover contains: a required reason text input, a quantity radio group (full close / partial 50%), a confirm button, a spinner during the request, and a toast notification on success or failure. Calls POST /positions/{id}/close on confirmation.

## Acceptance Criteria
- [ ] "Close" button visible on open positions only
- [ ] Clicking "Close" opens an inline popover with: reason input (required), quantity radio (Full / Partial 50%), Confirm button
- [ ] Confirm button is disabled until reason is entered
- [ ] On confirm: spinner shown, POST /positions/{id}/close called with reason and quantity
- [ ] On success: toast notification, position state updates in the list (re-fetch or local update)
- [ ] On failure: inline error message in popover, can retry

## Technical Notes
- Use bootstrap-vue-next `<b-popover>` for the inline popover
- POST /positions/{id}/close endpoint from story-007-008
- Payload: `{ reason: "text", close_type: "full"|"partial", close_pct: 100|50 }`
- After successful close, refetch positions via usePositions composable to update the list
- Toast: use bootstrap-vue-next toast component or a simple custom toast

## Dependencies
- Depends on: task-008-007-01 (position list with open position rendering)
- Blocks: none
