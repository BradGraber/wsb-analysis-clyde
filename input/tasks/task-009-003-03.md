---
id: task-009-003-03
story: story-009-003
title: Implement graceful degradation and warning handling for unavailable predictions
complexity: 1
---

# Task: Implement graceful degradation and warning handling for unavailable predictions

## Description
Handle the failure cases in prediction creation: when Schwab API is unavailable for a ticker, or when no valid strike is found (no expiration in DTE range or no delta match). In both cases, set the prediction status='expired' and append the appropriate warning to the run warnings. Warning types: `schwab_prediction_unavailable` (API failure) and `prediction_strike_unavailable` (no valid strike). PRD warning table lines 363-364.

## Acceptance Criteria
- [ ] When Schwab API is unavailable for a ticker: prediction status set to 'expired', `schwab_prediction_unavailable` warning appended to run warnings
- [ ] When no valid strike found (no DTE match or no delta match): prediction status set to 'expired', `prediction_strike_unavailable` warning appended
- [ ] Expired predictions have NULL contract_symbol, strike_price, expiration_date, entry_premium
- [ ] Expired predictions do not affect author accuracy (they are never monitored or resolved)
- [ ] Warning messages include the ticker symbol for diagnostic traceability
- [ ] Both warning paths have unit tests verifying status and warning message

## Technical Notes
- Warning types match the PRD warning table entries (lines 363-364)
- These predictions are effectively dead records -- they exist for audit trail but will never enter Phase 6 monitoring
- The warning append pattern should reuse the run_warnings list pattern from other pipeline phases
- This is a simple branching/error-handling addition to the prediction creation flow

## Dependencies
- Depends on: task-009-003-02 (called when strike selection or Schwab fetch fails)
- Blocks: none
