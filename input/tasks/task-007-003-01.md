---
id: task-007-003-01
story: story-007-003
title: Implement GET /signals, /signals/{id}, /signals/{id}/comments, and /signals/history endpoints
complexity: 2
---

# Task: Implement GET /signals, /signals/{id}, /signals/{id}/comments, and /signals/history endpoints

## Description
Implement the four signal-related GET endpoints. The list endpoint supports filters (ticker, signal_type, date_from, date_to, portfolio_id) and includes computed position_summary and skip_reason per signal. The detail endpoint returns full signal data. The comments endpoint returns paginated comments with AI annotation fields from the junction table (sentiment badge, sarcasm flag, reasoning indicator, confidence) plus author_trust_score and ticker_sentiments. The history endpoint returns confidence values grouped by ticker for sparkline rendering. Phase 7a task (Weeks 2-3).

## Acceptance Criteria
- [ ] GET /signals returns paginated signals with all 5 filter parameters working individually and combined
- [ ] Each signal in the list includes `position_summary` (count of positions across portfolios, status breakdown)
- [ ] Each signal in the list includes `skip_reason` computed per portfolio_id filter (bearish_long_only when applicable, generic "not eligible" otherwise)
- [ ] GET /signals/{id} returns single signal with all stored fields; returns NOT_FOUND for invalid ID
- [ ] GET /signals/{id}/comments returns paginated comments with AI annotation fields: sentiment, sarcasm_flag, reasoning_indicator, confidence_score
- [ ] Comments include `author_trust_score` (from authors table) and `ticker_sentiments` (from signal_comments junction)
- [ ] GET /signals/history accepts optional ticker, signal_type, and days (default 14) parameters; returns confidence values grouped by ticker
- [ ] All endpoints use response envelope with pagination where applicable
- [ ] Empty result sets return 200 with empty data array (not 404)

## Technical Notes
- position_summary requires a subquery or join: COUNT positions WHERE signal_id = signal.id, grouped by status
- skip_reason logic: if portfolio is long_only (direction check) and signal is bearish, return "bearish_long_only"; otherwise "not eligible" (SD-009 limitation)
- signals/history is used by frontend sparkline charts; keep response lightweight (ticker, date, confidence only)
- Comments AI annotations come from signal_comments junction table, not the comments table directly
- Consider creating a `src/api/routes/signals.py` router module

## Dependencies
- Depends on: task-007-002-01, task-007-002-02 (response envelope, pagination, error handlers)
- Blocks: task-007-004-01 (seed data should verify these endpoints)
