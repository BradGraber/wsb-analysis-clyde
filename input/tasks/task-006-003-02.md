---
id: task-006-003-02
story: story-006-003
title: Implement stock trailing stop exit condition function
complexity: 2
---

# Task: Implement stock trailing stop exit condition function

## Description
Implement the private stock trailing stop exit condition function. When trailing_stop_active is TRUE, check if any candle's low breaches peak_price * 0.93 (7% drop from peak). On breach, trigger a full close of all remaining shares with exit_reason='trailing_stop' and exit_price=peak_price*0.93.

## Acceptance Criteria
- [ ] Function only evaluates when trailing_stop_active is TRUE; returns None otherwise
- [ ] Triggers when candle.low <= peak_price * 0.93
- [ ] Exit price is set to peak_price * 0.93 (trigger level, not candle price)
- [ ] Exits 100% of shares_remaining (full close of remainder)
- [ ] Exit reason is 'trailing_stop'
- [ ] Function accepts MonitoredInstrument (not concrete Position type)

## Technical Notes
- FR-028: Trailing stop at peak_price * (1 - 0.07) = peak_price * 0.93
- PIPE-044: Trailing stop is third priority after take-profit in stock cascade
- peak_price is tracked by story-006-010 and represents the historical high since position open
- Trailing stop only fires after partial take-profit has occurred (trailing_stop_active guard)

## Dependencies
- Depends on: task-006-003-01 (trailing stop activates after partial take-profit), task-006-010-01 (peak_price tracking)
- Blocks: none
