---
id: task-009-001-01
story: story-009-001
title: Implement calculate_trust_score function with config-driven weights and unit tests
complexity: 2
---

# Task: Implement calculate_trust_score function with config-driven weights and unit tests

## Description
Create a shared utility function `calculate_trust_score(author, config)` that computes the 3-component weighted trust score: quality_ratio * weight_quality + accuracy_component * weight_accuracy + tenure_factor * weight_tenure. All weights and defaults are read from system_config (trust_weight_quality, trust_weight_accuracy, trust_weight_tenure, trust_default_accuracy, trust_tenure_saturation_days). Returns a float in [0.0, 1.0] rounded to 3 decimal places. Include unit tests covering cold start, established author, NULL accuracy, and tenure saturation. PRD Appendix F.2, lines 2899-2968.

## Acceptance Criteria
- [ ] `calculate_trust_score(author)` exists as a standalone importable function (shared utility, not coupled to any pipeline phase)
- [ ] Quality ratio computed as `high_quality_comments / max(total_comments, 1)`
- [ ] Accuracy component uses `avg_sentiment_accuracy` when not NULL, falls back to `trust_default_accuracy` config value (default 0.50)
- [ ] Tenure factor computed as `min(1.0, days_since_first_seen / trust_tenure_saturation_days)` with saturation_days from config (default 30)
- [ ] All 3 weights read from system_config at runtime, not hardcoded
- [ ] Return value rounded to 3 decimal places, clamped to [0.0, 1.0]
- [ ] Cold start verified: new author (0 comments, NULL accuracy, first_seen=today) returns exactly `trust_default_accuracy * trust_weight_accuracy` (0.25 with defaults)
- [ ] Unit tests cover: cold start, established author (all components populated), NULL accuracy with high quality ratio, tenure > saturation days (capped at 1.0), edge case of 0 total_comments

## Technical Notes
- This function is called in Phase 2 (comment prioritization), Phase 3 (AI prompt context), Phase 4 (signal confidence), and Phase 7a (after metrics update) -- must be a shared utility module
- 6 config keys: trust_weight_quality (0.40), trust_weight_accuracy (0.50), trust_weight_tenure (0.10), trust_default_accuracy (0.50), trust_tenure_saturation_days (30), accuracy_ema_weight (0.30)
- Config values should be fetched once per pipeline run and passed in or cached, not queried per-author
- Pure computation function -- no database writes, easy to test

## Dependencies
- Depends on: epic-001 (authors table schema, system_config entries for trust weights)
- Blocks: task-009-002-01, task-009-004-01
