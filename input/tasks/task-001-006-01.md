---
id: task-001-006-01
story: story-001-006
epic: epic-001
title: Build Schwab OAuth CLI setup script with token storage
complexity: 2
---

# Task: Build Schwab OAuth CLI setup script with token storage

## Description
Create `scripts/schwab_setup.py` implementing the OAuth 2.0 Authorization Code Grant flow for the Schwab API. The script opens the default browser to the Schwab authorization URL, prompts the user to paste the callback URL after consent, exchanges the authorization code for access and refresh tokens, and stores them in `./data/schwab_token.json` with chmod 600 permissions. Token file includes access_token, refresh_token, expires_at, and refresh_expires_at fields.

## Acceptance Criteria
- [ ] Script opens default browser to Schwab OAuth authorization URL (constructed from client_id + redirect_uri)
- [ ] Prompts user to paste callback URL after authorization consent
- [ ] Extracts authorization code from callback URL query parameters
- [ ] Exchanges code for tokens via POST to Schwab token endpoint
- [ ] Stores tokens in `./data/schwab_token.json` with fields: access_token, refresh_token, expires_at (timestamp), refresh_expires_at (timestamp)
- [ ] Token file created with chmod 600 (owner read/write only)
- [ ] `./data/schwab_token.json` is in .gitignore
- [ ] Creates `./data/` directory if it does not exist
- [ ] Reads SCHWAB_CLIENT_ID, SCHWAB_CLIENT_SECRET, SCHWAB_REDIRECT_URI from environment or .env file

## Technical Notes
- Schwab OAuth uses Authorization Code Grant (not client credentials)
- Access token TTL ~30 minutes, refresh token TTL ~7 days
- Use webbrowser.open() for browser launch
- Use requests library for token exchange POST
- Token file JSON structure: {"access_token": "...", "refresh_token": "...", "expires_at": 1234567890, "refresh_expires_at": 1234567890}
- Reference: `resources/schwab-streamer-api.md`
- If Schwab developer app not yet approved, document the blocker

## Files to Create/Modify
- `scripts/schwab_setup.py` (new file)
- `.gitignore` (verify/add data/schwab_token.json entry)
