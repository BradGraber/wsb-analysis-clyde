---
id: task-007-001-01
story: story-007-001
title: Initialize FastAPI application with lifespan, CORS, and structlog
complexity: 2
---

# Task: Initialize FastAPI application with lifespan, CORS, and structlog

## Description
Create the FastAPI application entry point with a lifespan context manager that acquires/releases the database connection from epic-001's connection manager. Configure CORS middleware for local Vue dev server origins and set up structlog with JSON formatting to `logs/backend.log`. Phase 7a task (Weeks 2-3).

## Acceptance Criteria
- [ ] FastAPI app instance created in `src/api/app.py` (or equivalent module)
- [ ] Lifespan context manager acquires DB connection via epic-001 `get_connection()` on startup and closes on shutdown
- [ ] DB connection stored in `app.state.db` for access by route handlers
- [ ] CORS middleware allows localhost:5173 (Vue dev server) with configurable origins
- [ ] structlog configured with JSON processor pipeline, output to `logs/backend.log`
- [ ] Log directory created automatically if not present
- [ ] `GET /` or `GET /health` returns 200 for basic health check
- [ ] Application starts cleanly with `uvicorn src.api.app:app`

## Technical Notes
- Use FastAPI lifespan context manager (not deprecated `on_event` decorators)
- structlog config: `structlog.configure(processors=[...], wrapper_class=structlog.stdlib.BoundLogger, logger_factory=structlog.PrintLoggerFactory())`
- CORS origins list should come from environment variable or config, defaulting to `["http://localhost:5173"]`
- Log levels: DEBUG in development, INFO in production (configurable)
- This is the first file created in the API layer; establish module structure (`src/api/`)

## Dependencies
- Depends on: task-001-004-01 (get_connection context manager from epic-001)
- Blocks: task-007-002-01, task-007-002-02
