---
id: task-003-001-01
story: story-003-001
title: Implement OpenAI client wrapper with bearer token authentication
complexity: 2
---

# Task: Implement OpenAI client wrapper with bearer token authentication

## Description
Create an `src/ai_client.py` module with an `OpenAIClient` class that wraps the official openai Python SDK. The client reads OPENAI_API_KEY from environment, validates it at initialization (raising a clear error if missing/empty), and exposes a `send_chat_completion(system_prompt, user_prompt)` method that sends requests to POST /v1/chat/completions using gpt-4o-mini. Returns the raw response content string for downstream parsing (story-003-005). Logs API errors (connection timeout, 5xx) via structlog with request context.

## Acceptance Criteria
- [ ] `OpenAIClient.__init__()` reads OPENAI_API_KEY from environment variable
- [ ] Missing or empty OPENAI_API_KEY raises `ValueError` with descriptive message at initialization time
- [ ] `send_chat_completion(system_prompt, user_prompt)` calls OpenAI chat completions API with model="gpt-4o-mini"
- [ ] Method returns the raw response content string (message.content) to the caller
- [ ] Also returns token usage counts (prompt_tokens, completion_tokens) alongside the content for cost tracking (task-003-001-02)
- [ ] Connection errors and 5xx server errors are caught, logged via structlog with model name and token context, and re-raised
- [ ] Unit test: successful call returns content and token counts
- [ ] Unit test: missing API key raises ValueError at init

## Technical Notes
- Use `openai.OpenAI(api_key=...)` client pattern (v1+ SDK)
- Return a dataclass or named tuple with (content: str, prompt_tokens: int, completion_tokens: int)
- Rate limit (429) handling is separate (story-003-006); this task only handles connection-level errors
- This client is consumed by story-003-004 (concurrent batching) and story-002-002 (image analysis)
- PRD reference: INT-OPENAI

## Dependencies
- Depends on: none (epic-001 provides database, but client itself has no DB dependency)
- Blocks: task-003-001-02, task-003-002-01, task-003-004-01
