---
id: task-008-005-02
story: story-008-005
title: Implement price sparkline with lazy loading and concurrency throttle
complexity: 2
---

# Task: Implement price sparkline with lazy loading and concurrency throttle

## Description
Build the price sparkline component that lazy-loads per visible signal card via GET /prices/{ticker}?days=14. Implement a concurrency throttle of max 5 simultaneous requests using a semaphore or queue pattern (e.g., p-limit). Apply the same adaptive rendering and caching strategy as the confidence sparkline. Show placeholder while loading.

## Acceptance Criteria
- [ ] Price sparkline renders at ~100px x 30px within each signal card
- [ ] Data fetched lazily per signal card via GET /prices/{ticker}?days=14
- [ ] Max 5 concurrent price requests in-flight at any time
- [ ] Adaptive rendering: <=2 points -> scatter dots, 3+ points -> line
- [ ] Loading placeholder displayed while fetch is in progress
- [ ] Data cached in-memory per portfolio tab (no re-fetch on tab switch)

## Technical Notes
- Concurrency throttle: use p-limit npm package or a custom semaphore implementation
- Lazy loading: trigger fetch when signal card is rendered/visible (or on tab mount for all visible cards)
- Cache: Map<portfolioId, Map<ticker, priceData>> stored at composable level
- Same sparkline rendering component as confidence sparkline, just different data source
- FR-008: Price sparkline shows stock price over 7-14 day window

## Dependencies
- Depends on: task-008-003-01 (signal cards provide mounting point), task-008-004-01 (spike determines library)
- Blocks: none
