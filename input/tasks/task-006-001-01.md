---
id: task-006-001-01
story: story-006-001
title: Implement last_check_time derivation from analysis_runs
complexity: 2
---

# Task: Implement last_check_time derivation from analysis_runs

## Description
Build the function that derives last_check_time for the current monitoring cycle. Query the analysis_runs table for the most recent completed run's started_at timestamp. On first run (no prior analysis_runs), default to the current run's started_at so only same-day data is fetched. This value drives the tiered fetching strategy downstream (PIPE-042).

## Acceptance Criteria
- [ ] Function queries analysis_runs for most recent completed run's started_at
- [ ] First run (no prior rows) defaults to current run's started_at
- [ ] Returns a datetime/timestamp suitable for gap calculation
- [ ] Unit test covers both first-run and subsequent-run scenarios

## Technical Notes
- PIPE-042: Derive last_check_time from analysis_runs table
- analysis_runs table schema is defined in epic-001
- The gap between last_check_time and now determines which tier of the fetching strategy is used

## Dependencies
- Depends on: epic-001 (analysis_runs table)
- Blocks: task-006-001-02, task-006-001-03
