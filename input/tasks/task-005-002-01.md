---
id: task-005-002-01
story: story-005-002
title: Implement qualified signal query with configurable confidence threshold
complexity: 2
---

# Task: Implement qualified signal query with configurable confidence threshold

## Description
Create a function that queries the signals table for signals eligible for position opening: confidence >= threshold AND position_opened = false. The confidence threshold is read from system_config key `signal_min_confidence` (default 0.5, seeded in story-001-002). Returns Signal model objects ordered by confidence DESC for deterministic processing order.

## Acceptance Criteria
- [ ] Query filters signals WHERE confidence >= signal_min_confidence AND position_opened = false
- [ ] Confidence threshold is read from system_config at runtime, not hardcoded
- [ ] Results are ordered by confidence DESC (highest-confidence signals processed first)
- [ ] Returns list of Signal model objects with: id, ticker, signal_type, direction, confidence, signal_date
- [ ] Returns empty list (not error) when no signals qualify
- [ ] Signals with position_opened = true are excluded
- [ ] Unit tests cover: signals above/below threshold, already-acted signals excluded, empty result, ordering

## Technical Notes
- PIPE-032 requirement
- This is the entry point to the position management pipeline after market hours check
- The system_config lookup should be cached per pipeline run (read once, not per signal)
- signal_type is 'quality' or 'consensus' -- needed downstream for portfolio targeting
- direction is 'bullish' or 'bearish' -- needed for long-only filtering and options type selection

## Dependencies
- Depends on: task-005-001-01 (market hours gate must pass first in pipeline)
- Blocks: task-005-003-01
