---
id: task-002-004-01
story: story-002-004
title: Implement financial keyword detection and density scoring
complexity: 2
---

# Task: Implement financial keyword detection and density scoring

## Description
Create a `score_financial_keywords(body: str, keywords: list[str] = FINANCIAL_KEYWORDS, scaling_factor: float = 10.0) -> float` function that scans a comment body for financial terminology and returns a normalized density score (0.0-1.0). The keyword list is defined as a module-level constant for easy tuning. Matching is case-insensitive with word boundary awareness to reduce false positives.

## Acceptance Criteria
- [ ] FINANCIAL_KEYWORDS constant includes at minimum: calls, puts, options, strike, expiry, DD, due diligence, earnings, revenue, P/E, market cap, short, long, squeeze, gamma, theta, delta, IV, implied volatility
- [ ] Keyword matching is case-insensitive ("CALLS", "Calls", "calls" all match)
- [ ] Uses word boundary matching (regex \b) to avoid false positives (e.g., "called" does not match "calls", "option" does not match "options" unless "option" is also a keyword)
- [ ] financial_score = min(1.0, keyword_occurrences / total_word_count * scaling_factor) where scaling_factor defaults to 10.0
- [ ] Comments with zero keyword matches return 0.0
- [ ] Comments with empty or whitespace-only body return 0.0
- [ ] Multi-word keywords ("due diligence", "market cap", "implied volatility") are matched as phrases
- [ ] Unit test: zero-keyword comment returns 0.0
- [ ] Unit test: single-keyword comment returns correct density score
- [ ] Unit test: case-insensitive matching verified
- [ ] Unit test: word boundary prevents false positive ("called" != "calls")
- [ ] Unit test: empty body returns 0.0

## Technical Notes
- Pre-compile the regex pattern at module load time for performance (applied to ~10,000 comments)
- For multi-word keywords, match as phrases; for single words, use \b word boundaries
- The keyword list is intentionally extensible; WSB slang (tendies, diamond hands, YOLO) is NOT included here -- that is detected by AI in epic-003
- The scaling_factor (10.0) means a comment needs 10% keyword density to hit max score of 1.0
- financial_score feeds into priority formula at 40% weight (story-002-007)
- PRD reference: PIPE-009, Section 3.2.2 Phase 2 step 1 bullet 1

## Dependencies
- Depends on: task-002-003-01 (comments must be fetched with body text)
- Blocks: task-002-007-01 (priority scoring needs financial_score)
