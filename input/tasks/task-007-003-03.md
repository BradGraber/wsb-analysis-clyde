---
id: task-007-003-03
story: story-007-003
title: Implement GET /portfolios, /portfolios/{id}, and /evaluation-periods endpoints
complexity: 2
---

# Task: Implement GET /portfolios, /portfolios/{id}, and /evaluation-periods endpoints

## Description
Implement the portfolio and evaluation period GET endpoints. Portfolio list returns all 4 portfolios with computed summary stats. Portfolio detail returns a single portfolio with allocation breakdown. Evaluation periods are filtered by required portfolio_id parameter and return both active and completed periods with performance metrics. Phase 7a task (Weeks 2-3).

## Acceptance Criteria
- [ ] GET /portfolios returns all 4 portfolios, each with computed summary: value, cash, open_position_count, total_pnl, total_pnl_pct
- [ ] GET /portfolios/{id} returns single portfolio with allocation breakdown (positions grouped by ticker/sector or similar)
- [ ] Returns NOT_FOUND for invalid portfolio ID
- [ ] GET /evaluation-periods accepts required portfolio_id filter parameter; returns VALIDATION_ERROR if missing
- [ ] Evaluation periods include both active and completed periods with metrics (return_pct, sp500_return_pct, alpha, etc.)
- [ ] Portfolios endpoint does not paginate (fixed 4 portfolios) but still uses response envelope

## Technical Notes
- Portfolio summary calculations:
  - `value`: cash + SUM(current_price * shares_remaining) for open positions
  - `open_position_count`: COUNT positions WHERE portfolio_id = X AND status = 'open'
  - `total_pnl`: SUM(realized_return) for closed positions + SUM(unrealized) for open positions
  - `total_pnl_pct`: total_pnl / initial_cash * 100
- Allocation breakdown: group open positions by ticker, compute weight = position_value / total_value
- Evaluation periods are 30-day rolling windows; include S&P 500 benchmark comparison
- Create `src/api/routes/portfolios.py` router module

## Dependencies
- Depends on: task-007-002-01, task-007-002-02 (response envelope, pagination, error handlers)
- Blocks: task-007-004-01 (seed data should verify these endpoints)
