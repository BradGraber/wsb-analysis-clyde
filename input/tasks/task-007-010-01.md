---
id: task-007-010-01
story: story-007-010
title: Write Phase 7a API tests (envelope, pagination, GET errors)
complexity: 2
---

# Task: Write Phase 7a API tests (envelope, pagination, GET errors)

## Description
Write the first set of API unit tests covering the Phase 7a scaffold: response envelope structure validation, pagination boundary conditions, invalid filter handling, and NOT_FOUND responses. Uses FastAPI TestClient with an in-memory SQLite test database seeded with fixture data. These tests can be written and run as soon as Phase 7a endpoints are complete.

## Acceptance Criteria
- [ ] Test 1 (pagination - offset > total): GET /signals with offset=100 when only 5 signals exist; verify 200 with empty data array and total=5
- [ ] Test 2 (pagination - limit=0): verify either VALIDATION_ERROR or empty data array; document chosen behavior
- [ ] Test 3 (invalid filter): GET /positions with status='invalid_status'; verify VALIDATION_ERROR with descriptive message
- [ ] Test 4 (NOT_FOUND): GET /signals/99999; verify NOT_FOUND error envelope
- [ ] Test 10 (envelope structure): verify multiple endpoint responses include standard envelope: top-level data/error, meta with timestamp (ISO-8601) and version ("1.0")
- [ ] All tests use FastAPI TestClient (httpx-based) with in-memory SQLite test database
- [ ] Test database fixture seeds minimal data (leveraging seed_data patterns from task-007-004-01)
- [ ] Tests use pytest and pass in under 5 seconds

## Technical Notes
- Use `@pytest.fixture` for app + test client with in-memory DB: `sqlite3.connect(":memory:")`
- Apply schema.sql to in-memory DB, then insert minimal seed data
- Override FastAPI app dependency for DB connection to use test DB
- Test 2 (limit=0) needs a design decision: recommend treating limit=0 as VALIDATION_ERROR since it requests zero results
- These 5 tests correspond to tests 1, 2, 3, 4, 10 from story-007-010 acceptance criteria

## Dependencies
- Depends on: task-007-004-01 (seed data patterns), task-007-003-01 through task-007-003-04 (GET endpoints to test)
- Blocks: none
