---
id: task-008-012-02
story: story-008-012
title: Write 6 portfolio isolation integration tests
complexity: 2
---

# Task: Write 6 portfolio isolation integration tests

## Description
Write 6 integration tests verifying the 4 portfolios operate independently with no cross-contamination. Tests verify: (1) creating a position in portfolio 1 does not affect portfolio 2/3/4 cash, (2) closing in portfolio 3 does not affect portfolio 1/2/4 metrics, (3) signals exist independently in multiple portfolios, (4) evaluation period metrics scoped to single portfolio, (5) portfolio summary stats (total_pnl, open_position_count) are portfolio-specific, (6) partial close in one portfolio does not affect same ticker in another.

## Acceptance Criteria
- [ ] Test 1: Position creation in portfolio 1 -> portfolios 2/3/4 cash unchanged
- [ ] Test 2: Position close in portfolio 3 -> portfolios 1/2/4 metrics unchanged
- [ ] Test 3: Signals exist in multiple portfolios independently
- [ ] Test 4: Evaluation period metrics scoped to single portfolio
- [ ] Test 5: Portfolio summary stats are portfolio-specific
- [ ] Test 6: Partial close in portfolio X does not affect same ticker in portfolio Y
- [ ] All tests use seed data or test fixtures, runnable via `pytest`

## Technical Notes
- Portfolio isolation is critical: all 4 portfolios share the same database
- These tests catch JOIN/WHERE clause bugs that leak data across portfolios
- Test via REST API endpoints (integration tests)
- Each test should set up state, perform action on one portfolio, and verify others are unaffected
- Use clean database state between tests via pytest fixtures

## Dependencies
- Depends on: task-008-007-01 (position list exists to validate rendering)
- Blocks: none
