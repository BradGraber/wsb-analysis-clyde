---
id: task-006-004-01
story: story-006-004
title: Implement breakeven stop promotion logic
complexity: 2
---

# Task: Implement breakeven stop promotion logic

## Description
Implement the breakeven stop promotion function. When a stock position has unrealized gain >= +5% AND hold_days >= 5, update the position's stop_loss_price to entry_price (breakeven promotion). If the promoted stop subsequently fires via the existing stop-loss check, the exit_reason is discriminated as 'breakeven_stop' per PIPE-048 (when stop_loss_price == entry_price).

## Acceptance Criteria
- [ ] Breakeven promotion triggers when gain >= +5% AND hold_days >= 5
- [ ] Updates stop_loss_price to entry_price on the position record
- [ ] If stop_loss_price == entry_price when stop-loss fires, exit_reason = 'breakeven_stop' (PIPE-048)
- [ ] Breakeven check runs in priority order: after trailing stop, before time stop (PIPE-044)
- [ ] hold_days uses calendar days from open_date
- [ ] Promotion is persistent: once promoted, stop_loss_price stays at entry_price

## Technical Notes
- FR-030: Breakeven stop promotion at +5% gain and Day 5
- PIPE-048: exit_reason discrimination when stop_loss_price == entry_price
- The breakeven promotion modifies the stop_loss_price in-place, then the regular stop-loss check handles the actual exit
- gain calculation: (current_price - entry_price) / entry_price

## Dependencies
- Depends on: task-006-002-01 (stop-loss mechanism reused for breakeven detection)
- Blocks: none
