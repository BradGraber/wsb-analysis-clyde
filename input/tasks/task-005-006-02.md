---
id: task-005-006-02
story: story-005-006
title: Implement delta-based strike selection with tolerance filtering
complexity: 3
---

# Task: Implement delta-based strike selection with tolerance filtering

## Description
Create the second half of the strike selection module: given an expiration's strike data and an option type (call/put), sort strikes by distance from target delta (0.30), filter to tolerance bands ([+0.15, +0.50] for calls, [-0.50, -0.15] for puts), and return the best strike. Returns contract_symbol, strike_price, expiration_date, delta, and current premium (mark price). Returns None if no valid strike exists.

## Acceptance Criteria
- [ ] For calls: sorts by |delta - 0.30|, filters delta to [+0.15, +0.50] inclusive
- [ ] For puts: sorts by |delta - (-0.30)|, filters delta to [-0.50, -0.15] inclusive
- [ ] Returns the closest valid strike with: contract_symbol, strike_price, expiration_date, delta, mark_price (premium)
- [ ] Returns None with warning log if no strikes fall within tolerance range
- [ ] Handles edge case where all strikes have delta outside tolerance (deep ITM/OTM chains)
- [ ] Function signature: `select_strike(ticker, option_type: str) -> Optional[StrikeInfo]` combining DTE filtering and delta selection
- [ ] Composed with task-005-006-01: calls chain fetch, gets filtered expiration, then applies delta selection
- [ ] Unit tests with VCR.py: valid call selection, valid put selection, no valid strike, boundary delta values (0.15, 0.50)

## Technical Notes
- FR-037 requirement (second half)
- Delta values from Schwab: calls have positive delta (0 to +1), puts have negative delta (-1 to 0)
- The tolerance bands are asymmetric around 0.30 target: [0.15, 0.50] gives more room toward ATM
- mark_price is the mid-point between bid and ask for the selected strike
- This is the complete reusable function -- epic-009 (story-009-003) calls this same function for prediction creation
- Consider returning a typed dataclass/NamedTuple (StrikeInfo) rather than a dict

## Dependencies
- Depends on: task-005-006-01 (chain fetch and DTE filtering)
- Blocks: task-005-007-01 (position opening needs strike info for options)
